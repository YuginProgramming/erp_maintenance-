// Handle /help command
export const handleHelpCommand = (bot) => {
    bot.onText(/\/help/, async (msg) => {
        const chatId = msg.chat.id;
        
        const helpMessage = `ü§ñ **–í–æ–¥—è–Ω–∏–π –±–æ—Ç - –î–æ–≤—ñ–¥–∫–∞**\n\n` +
            `**–û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:**\n` +
            `/start - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞\n` +
            `/help - –ü–æ–∫–∞–∑ —Ü—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ–ø–æ–º–æ–≥–∏\n` +
            `/status - –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å—É —Å–∏—Å—Ç–µ–º–∏\n` +
            `/test_db - –¢–µ—Å—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö\n` +
            `/alerts - –ü–æ–∫–∞–∑ —Ç–µ—Ä–º—ñ–Ω–æ–≤–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å\n` +
            `/devices - –ü–æ–∫–∞–∑ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∞–ø–∞—Ä–∞—Ç—ñ–≤ –∑ API\n` +
            `/collection - –ü–æ–∫–∞–∑ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –≤—Å—ñ—Ö –∞–ø–∞—Ä–∞—Ç—ñ–≤ (–∑ –≤–∏–±–æ—Ä–æ–º –ø–µ—Ä—ñ–æ–¥—É)\n` +
            `/collection [device_id] - –ü–æ–∫–∞–∑ –¥–∞–Ω–∏—Ö —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–ø–∞—Ä–∞—Ç—É (–∑ –≤–∏–±–æ—Ä–æ–º –ø–µ—Ä—ñ–æ–¥—É)\n` +
            `/collection [device_id] [start_date] [end_date] - –ü–æ–∫–∞–∑ –¥–∞–Ω–∏—Ö —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑ –≤–ª–∞—Å–Ω–∏–º –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º –¥–∞—Ç\n` +
            `/fetch_daily - –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ —â–æ–¥–µ–Ω–Ω–æ–≥–æ –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó\n` +
            `/summary - –ü–æ–∫–∞–∑ —â–æ–¥–µ–Ω–Ω–æ–≥–æ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑–∞ –≤—á–æ—Ä–∞\n` +
            `/summary [YYYY-MM-DD] - –ü–æ–∫–∞–∑ —â–æ–¥–µ–Ω–Ω–æ–≥–æ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –¥–∞—Ç–∏\n` +
            `/summary_today - –ü–æ–∫–∞–∑ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—å–æ–≥–æ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó\n` +
            `/send_summary_all - –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —â–æ–¥–µ–Ω–Ω–æ–≥–æ –∑–≤—ñ—Ç—É –≤—Å—ñ–º –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞–º\n` +
            `/check_data - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞–Ω–∏—Ö —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑–∞ –≤—á–æ—Ä–∞\n` +
            `/check_data [YYYY-MM-DD] - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞–Ω–∏—Ö —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –¥–∞—Ç–∏\n` +
            `/data_availability - –ü–æ–∫–∞–∑ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 60 –¥–Ω—ñ–≤\n` +
            `/devices_list - –ü–æ–∫–∞–∑ —Å–ø–∏—Å–∫—É –≤—Å—ñ—Ö –∞–ø–∞—Ä–∞—Ç—ñ–≤ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö\n` +
            `/completeness_check - –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–≤–Ω–æ—Ç–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ 30 –¥–Ω—ñ–≤)\n` +
            `/force_summary - –ü—Ä–∏–º—É—Å–æ–≤–µ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è —â–æ–¥–µ–Ω–Ω–æ–≥–æ –∑–≤—ñ—Ç—É –¥–ª—è —Å—å–æ–≥–æ–¥–Ω—ñ\n` +
            `/report_previous_day - –ü–æ–∫–∞–∑ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –¥–µ–Ω—å\n` +
            `/report_previous_week - –ü–æ–∫–∞–∑ —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∏–∂–¥–µ–Ω—å\n` +
            `/report_previous_month - –ü–æ–∫–∞–∑ –º—ñ—Å—è—á–Ω–æ–≥–æ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –º—ñ—Å—è—Ü—å\n` +
            `/report_week - –ü–æ–∫–∞–∑ —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑–∞ –ø–æ—Ç–æ—á–Ω–∏–π —Ç–∏–∂–¥–µ–Ω—å\n` +
            `/report_month - –ü–æ–∫–∞–∑ –º—ñ—Å—è—á–Ω–æ–≥–æ –∑–≤—ñ—Ç—É —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –∑–∞ –ø–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü—å\n` +
            `/help - –ü–æ–∫–∞–∑ —Ü—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ–ø–æ–º–æ–≥–∏\n\n` +
            `**–ü—Ä–∏–∫–ª–∞–¥–∏ —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó:**\n` +
            `/collection - –ó–≤—ñ—Ç —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó –≤—Å—ñ—Ö –∞–ø–∞—Ä–∞—Ç—ñ–≤ (–∑ –≤–∏–±–æ—Ä–æ–º –ø–µ—Ä—ñ–æ–¥—É)\n` +
            `/collection 164 - –ê–ø–∞—Ä–∞—Ç 164 (–∑ –≤–∏–±–æ—Ä–æ–º –ø–µ—Ä—ñ–æ–¥—É)\n` +
            `/collection 164 2025-06-01 2025-06-30 - –ê–ø–∞—Ä–∞—Ç 164 –∑ –≤–ª–∞—Å–Ω–∏–º –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º –¥–∞—Ç\n\n` +
            `**–ü—Ä–∏–∫–ª–∞–¥–∏ –∑–≤—ñ—Ç—ñ–≤:**\n` +
            `/summary 2025-06-15 - –ó–≤—ñ—Ç –∑–∞ 15 —á–µ—Ä–≤–Ω—è 2025\n` +
            `/send_summary_all 2025-06-15 - –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–≤—ñ—Ç –∑–∞ 15 —á–µ—Ä–≤–Ω—è –≤—Å—ñ–º –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∞–º\n\n` +
            `üí° **–ü–æ—Ä–∞–¥–∏:**\n` +
            `‚Ä¢ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö\n` +
            `‚Ä¢ –î–∞—Ç–∏ –≤–∫–∞–∑—É–π—Ç–µ —É —Ñ–æ—Ä–º–∞—Ç—ñ YYYY-MM-DD\n` +
            `‚Ä¢ –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–∏—Ä–∞—î –¥–∞–Ω—ñ —â–æ–¥–Ω—è –æ 8:00 –∑–∞ –∫–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º`;
        
        await bot.sendMessage(chatId, helpMessage, { parse_mode: 'Markdown' });
    });
};

// Handle /start command
export const handleStartCommand = (bot) => {
    bot.onText(/\/start/, async (msg) => {
        const chatId = msg.chat.id;
        const welcomeMessage = `ü§ñ **–í–æ–¥—è–Ω–∏–π –±–æ—Ç –∑–∞–ø—É—â–µ–Ω–∏–π!**\n\n` +
            `–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ —Å–∏—Å—Ç–µ–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤–æ–¥—è–Ω–∏–º–∏ –∞–ø–∞—Ä–∞—Ç–∞–º–∏!\n\n` +
            `üìä **–û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**\n` +
            `‚Ä¢ –ü–µ—Ä–µ–≥–ª—è–¥ –¥–∞–Ω–∏—Ö —ñ–Ω–∫–∞—Å–∞—Ü—ñ—ó\n` +
            `‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–≤—ñ—Ç—ñ–≤\n` +
            `‚Ä¢ –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∞–ø–∞—Ä–∞—Ç—ñ–≤\n` +
            `‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è\n\n` +
            `üí° –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ /help –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –≤—Å—ñ—Ö –∫–æ–º–∞–Ω–¥`;
        
        await bot.sendMessage(chatId, welcomeMessage, { parse_mode: 'Markdown' });
    });
};

// Handle /test_db command
export const handleTestDbCommand = (bot) => {
    bot.onText(/\/test_db/, async (msg) => {
        const chatId = msg.chat.id;
        await bot.sendMessage(chatId, 'üîç –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö...');
        
        try {
            const { ensureConnection } = await import('../database/sequelize.js');
            const success = await ensureConnection();
            
            if (success) {
                await bot.sendMessage(chatId, '‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É—Å–ø—ñ—à–Ω–µ!');
            } else {
                await bot.sendMessage(chatId, '‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö');
            }
        } catch (error) {
            await bot.sendMessage(chatId, `‚ùå –ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö: ${error.message}`);
        }
    });
};

// Handle /status command
export const handleStatusCommand = (bot) => {
    bot.onText(/\/status/, async (msg) => {
        const chatId = msg.chat.id;
        
        const statusMessage = `üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏\n\n` +
            `ü§ñ –ë–æ—Ç: ‚úÖ –ê–∫—Ç–∏–≤–Ω–∏–π\n` +
            `üìÖ –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: ${new Date().toLocaleString('en-US')}\n` +
            `‚è∞ –ù–∞—Å—Ç—É–ø–Ω–∏–π –∑–±—ñ—Ä –¥–∞–Ω–∏—Ö: 8:00 –∑–∞–≤—Ç—Ä–∞ (–ö–∏—ó–≤)\n` +
            `üìä –ù–∞—Å—Ç—É–ø–Ω–∏–π –∑–≤—ñ—Ç: 8:00 –∑–∞–≤—Ç—Ä–∞ (–ö–∏—ó–≤)\n` +
            `üîÑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–≤–Ω–æ—Ç–∏: 13:00 –∑–∞–≤—Ç—Ä–∞ (–ö–∏—ó–≤)\n\n` +
            `üí° –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ /test_db –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö`;
        
        await bot.sendMessage(chatId, statusMessage);
    });
};
